<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>field</title>
<style>
  :root{
    --bg1:#0f1f24;
    --bg2:#050a0d;
    --card:rgba(15,35,42,0.86);
    --stroke:rgba(120,255,200,0.22);
    --mint1:#7ff5b6;
    --mint2:#63eaa3;
    --ink:#042214;
    --text:#e6f0f2;
    --muted:rgba(230,240,242,0.62);
  }

  *{box-sizing:border-box;}
  html,body{height:100%;}
  body{
    margin:0;
    min-height:100vh;
    background:
      radial-gradient(1200px 700px at 50% -10%, rgba(127,245,182,0.12), transparent 60%),
      radial-gradient(900px 600px at 20% 40%, rgba(99,234,163,0.08), transparent 55%),
      radial-gradient(circle at top, var(--bg1), var(--bg2));
    color:var(--text);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    font-family: Georgia, serif;
    padding:
      calc(env(safe-area-inset-top, 0px) + 18px)
      16px
      calc(env(safe-area-inset-bottom, 0px) + 22px);
  }

  .header{
    font-size: clamp(2.6rem, 7vw, 3.6rem);
    letter-spacing: 0.22em;
    opacity:0.88;
    margin-top: 18px;
    margin-bottom: 56px;
    text-align:center;
    user-select:none;
  }

  .card{
    width:min(92vw, 440px);
    background:var(--card);
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    border-radius:28px;
    padding: 56px 36px 60px;
    text-align:center;
    box-shadow:
      0 0 90px rgba(0,255,180,0.08),
      0 0 0 1px rgba(120,255,200,0.08) inset;
  }

  .circle-wrap{
    width: 100%;
    display:flex;
    justify-content:center;
    margin-bottom: 52px;
  }

  .circle{
    width: 220px;
    height: 220px;
    border-radius: 50%;
    background: radial-gradient(circle at 35% 30%, rgba(255,255,255,0.22), transparent 55%),
                radial-gradient(circle, var(--mint1), var(--mint2));
    display:flex;
    align-items:center;
    justify-content:center;
    font-family: Arial, sans-serif;
    letter-spacing: 0.14em;
    font-size: 0.9rem;
    color: rgba(7,51,30,0.90);
    box-shadow:
      0 0 70px rgba(127,245,182,0.18),
      0 0 0 1px rgba(120,255,200,0.10) inset;
    transform: scale(0.80);
    transition: transform 5500ms ease-in-out;
    user-select:none;
    cursor:pointer;
  }

  .times{
    display:flex;
    justify-content:center;
    gap:14px;
    margin: 0 0 64px;
    user-select:none;
  }

  .time{
    padding: 8px 16px;
    border-radius: 999px;
    border: 1px solid var(--stroke);
    color: rgba(159,230,196,0.86);
    font-size: 0.9rem;
    min-width: 64px;
    text-align:center;
    cursor:pointer;
    transition: background 180ms ease, transform 120ms ease;
  }
  .time:active{ transform: scale(0.98); }
  .time.active{
    background: rgba(120,255,200,0.16);
    border-color: rgba(120,255,200,0.32);
  }

  .intention{
    font-size: clamp(1.9rem, 5.4vw, 2.35rem);
    margin: 0 0 18px;
    line-height:1.15;
  }

  .shared{
    font-size: 0.98rem;
    color: var(--muted);
    letter-spacing: 0.04em;
    margin: 0 0 44px;
    transition: opacity 260ms ease, transform 260ms ease;
  }
  .shared.fade{
    opacity: 0.25;
    transform: translateY(-2px);
  }

  .btn{
    border:none;
    border-radius: 999px;
    padding: 14px 48px;
    font-size: 1.05rem;
    cursor:pointer;
    color: var(--ink);
    background: linear-gradient(135deg, var(--mint1), var(--mint2));
    box-shadow: 0 10px 28px rgba(99,234,163,0.14);
    transition: transform 120ms ease, opacity 180ms ease;
  }
  .btn:active{ transform: scale(0.98); }

  .btn.secondary{
    margin-top: 12px;
    background: transparent;
    color: rgba(230,240,242,0.62);
    border: 1px solid rgba(120,255,200,0.14);
    box-shadow: none;
    padding: 12px 40px;
  }

  .btn[disabled]{
    opacity: 0.55;
    cursor: default;
  }

  /* tiny state */
  .hint{
    margin-top: 18px;
    font-family: Arial, sans-serif;
    font-size: 0.9rem;
    color: rgba(230,240,242,0.40);
    letter-spacing: 0.08em;
    min-height: 1.1em;
  }

  /* prefer reduced motion */
  @media (prefers-reduced-motion: reduce){
    .circle{ transition: none; }
    .time{ transition: none; }
    .btn{ transition: none; }
    .shared{ transition: none; }
  }
</style>
</head>
<body>

  <div class="header" aria-label="Field">field</div>

  <main class="card" role="main">
    <div class="circle-wrap">
      <div id="circle" class="circle" role="button" tabindex="0" aria-label="Tap to begin breathing">TAP TO BEGIN</div>
    </div>

    <div class="times" aria-label="Session duration">
      <div class="time active" data-min="5">5m</div>
      <div class="time" data-min="10">10m</div>
      <div class="time" data-min="15">15m</div>
    </div>

    <div class="intention" id="intention">Equanimity and awareness</div>
    <div class="shared" id="shared">the field is shared.</div>

    <button id="startBtn" class="btn" type="button">Start</button>
    <button id="stopBtn" class="btn secondary" type="button" disabled>Stop</button>

    <div class="hint" id="hint"></div>
  </main>

<script>
(() => {
  // Breath pattern: 5.5 in / 5.5 out (no holds)
  const inhaleSec = 5.5;
  const exhaleSec = 5.5;

  const circle = document.getElementById('circle');
  const startBtn = document.getElementById('startBtn');
  const stopBtn  = document.getElementById('stopBtn');
  const shared   = document.getElementById('shared');
  const hint     = document.getElementById('hint');
  const timeBtns = Array.from(document.querySelectorAll('.time'));

  let durationMin = 5;
  let running = false;
  let phase = 'idle'; // 'inhale' | 'exhale' | 'idle'
  let phaseTimer = null;
  let endTimer = null;
  let sessionEndsAt = 0;

  function setDuration(min){
    durationMin = min;
    timeBtns.forEach(b => b.classList.toggle('active', Number(b.dataset.min) === min));
  }

  function setCircleText(txt){
    circle.textContent = txt;
  }

  function setCircleScale(scale, seconds){
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches){
      circle.style.transition = 'none';
    } else {
      circle.style.transition = `transform ${Math.max(0.1, seconds)}s ease-in-out`;
    }
    circle.style.transform = `scale(${scale})`;
  }

  function clearTimers(){
    if (phaseTimer) { clearTimeout(phaseTimer); phaseTimer = null; }
    if (endTimer)   { clearTimeout(endTimer);   endTimer = null; }
  }

  function startSession(){
    if (running) return;
    running = true;
    shared.classList.add('fade');
    startBtn.disabled = true;
    stopBtn.disabled = false;

    const totalMs = durationMin * 60 * 1000;
    sessionEndsAt = Date.now() + totalMs;

    // begin inhale from a slightly smaller size
    phase = 'inhale';
    setCircleText('INHALE');
    setCircleScale(1.02, inhaleSec);

    phaseTimer = setTimeout(() => {
      if (!running) return;
      phase = 'exhale';
      setCircleText('EXHALE');
      setCircleScale(0.80, exhaleSec);

      // loop
      phaseTimer = setInterval(() => {
        if (!running) return;
        if (phase === 'exhale') {
          phase = 'inhale';
          setCircleText('INHALE');
          setCircleScale(1.02, inhaleSec);
          phaseTimer = setTimeout(() => {
            if (!running) return;
            phase = 'exhale';
            setCircleText('EXHALE');
            setCircleScale(0.80, exhaleSec);
          }, inhaleSec * 1000);
        }
      }, (inhaleSec + exhaleSec) * 1000);

    }, inhaleSec * 1000);

    // hard stop at session end
    endTimer = setTimeout(() => {
      stopSession(true);
    }, totalMs);

    tickHint();
  }

  function stopSession(completed=false){
    if (!running) return;
    running = false;
    clearTimers();

    shared.classList.remove('fade');
    startBtn.disabled = false;
    stopBtn.disabled = true;

    phase = 'idle';
    setCircleText(completed ? 'COMPLETE' : 'TAP TO BEGIN');
    setCircleScale(0.80, 0.2);

    hint.textContent = completed ? 'done' : '';
  }

  function tickHint(){
    if (!running) return;
    const remaining = Math.max(0, sessionEndsAt - Date.now());
    const s = Math.ceil(remaining / 1000);
    const m = Math.floor(s / 60);
    const r = s % 60;
    // keep subtle; show only last minute
    if (s <= 60){
      hint.textContent = `${m}:${String(r).padStart(2,'0')}`;
    } else {
      hint.textContent = '';
    }
    requestAnimationFrame(tickHint);
  }

  // Duration buttons (locked while running to keep clean)
  timeBtns.forEach(b => {
    b.addEventListener('click', () => {
      if (running) return;
      setDuration(Number(b.dataset.min));
    });
  });

  // Start / Stop
  startBtn.addEventListener('click', startSession);
  stopBtn.addEventListener('click', () => stopSession(false));

  // Tap circle to start/stop
  circle.addEventListener('click', () => running ? stopSession(false) : startSession());
  circle.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      running ? stopSession(false) : startSession();
    }
  });

  // initial
  setDuration(durationMin);
  setCircleScale(0.80, 0.2);
})();
</script>
</body>
</html>
