<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Coherence</title>

<style>
body {
  font-family: -apple-system, system-ui, Arial;
  background: #f5f7fb;
  margin: 0;
  padding: 20px;
  text-align: center;
}

h1 {
  margin-top: 20px;
}

button {
  font-size: 18px;
  padding: 12px 20px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  background: #6fa8ff;
  color: white;
  margin: 10px;
}

button.off {
  background: #888;
}

.card {
  background: white;
  max-width: 420px;
  margin: 30px auto;
  padding: 25px;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,.1);
}

.count {
  font-size: 42px;
  font-weight: bold;
  margin: 20px 0;
}
</style>
</head>

<body>

<h1>Coherence</h1>
<p>Reset ‚Ä¢ Steer ‚Ä¢ Reflect</p>

<div class="card">

  <div class="count" id="count">‚Äî</div>
  <div>üåê Shared Field</div>

  <br>

  <button id="joinBtn">Join Field</button>
  <button id="leaveBtn" class="off">Leave Field</button>

  <p id="status"></p>

</div>


<script>

// ================================
// YOUR WORKER URL (already added)
// ================================

const PRESENCE_BASE =
  "https://coherence-presence-2.lucolly999.workers.dev";


// ================================

let joined = false;
let sessionId = null;


// Fetch helper
async function api(path) {
  const res = await fetch(PRESENCE_BASE + path);
  return res.json();
}


// Update display
async function refresh() {
  const data = await api("/count");
  document.getElementById("count").textContent = data.count;
}


// Join
async function join() {

  if (joined) return;

  const data = await api("/join");

  joined = true;
  sessionId = data.id;

  document.getElementById("status").textContent =
    "Connected to field";

  refresh();
}


// Leave
async function leave() {

  if (!joined || !sessionId) return;

  await api("/leave?id=" + sessionId);

  joined = false;
  sessionId = null;

  document.getElementById("status").textContent =
    "Disconnected";

  refresh();
}


// Buttons
document.getElementById("joinBtn").onclick = join;
document.getElementById("leaveBtn").onclick = leave;


// Auto refresh
setInterval(refresh, 5000);
refresh();

</script>

</body>
</html>
